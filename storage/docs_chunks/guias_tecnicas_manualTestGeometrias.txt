Manual de aplicación: Test de Geometrías	ÍNDICE1. INTRODUCCIÓN A LA APLICACIÓN	31. Definición y utilidad	32. Ubicación de la aplicación	32. MANUAL PARA USUARIOS	31. Objetivo	32. Uso de la aplicación	32.1. Selección de la capa objetivo	32.2. Procedimiento de revisión	42.3. Cambiar de test	53. MANUAL PARA ADMINISTRADORES	61. Objetivo	62. Configuración de los test	62.1. Localización de la tabla de configuración	62.2. Configuración del test	63. Supervisión de las decisiones tomadas	73.1. Localización de la tabla de las decisiones	73.2. Estructura de la tabla	71. INTRODUCCIÓN A LA APLICACIÓNDefinición y utilidadLa aplicación Test de Geometrías sirve para revisar visualmente todas las geometrías de una capa sobre un fondo (topográfico, imagen de satélite...). Facilita el trabajo de revisión al quedar registro de los elementos ya trabajados, y siendo más fácil su manejo que en un SIG de escritorio (evita tener que cargar el fondo, controla los ya procesados…).Ubicación de la aplicaciónLa aplicación está disponible en la Plataforma de Servicios y Aplicaciones de IGEAR (PSA), tanto en desarrollo como en producción. Es necesario acceder con el usuario y la clave personal.  Dentro de la PSA, en el apartado de Geodatos, ya aparece el acceso a la aplicación “Test de Geometrías” (https://icearagondes.aragon.es/testGeometrias/index,  https://icearagon.aragon.es/testGeometrias/index)2. MANUAL PARA USUARIOSObjetivoEl objetivo de los usuarios de esta aplicación es revisar de manera visual los elementos que componen una capa (puntos, líneas o polígonos) almacenada en base de datos. Este proceso se lleva acabo sobre un fondo determinado -que puede ser: imágen de satélite, topográfico…-. En base a lo observado y comparado entre este y la capa objetivo, se debe tomar una decisión.Uso de la aplicaciónSelección de la capa objetivoTras haber accedido a la aplicación “Test de Geometrías” (desde PSA, desarrollo o producción), es necesario seleccionar la capa sobre la que se quiere llevar a cabo la revisión, e ‘Iniciar test’. Si la capa objetivo no está disponible en el desplegable, será necesario configurarla (ver apartado 3 de Manual para Administradores).Figura 1: selección de capas de la aplicaciónProcedimiento de revisiónEn primer lugar, hay que seleccionar el fondo sobre el que se quiere trabajar -topográfico u ortofoto-. Posteriormente se puede ir cambiando si es necesario.La geometría a corregir aparece en el recuadro de visualización representada de color azul. Conserva la forma de origen: punto, línea o polígono. Figura 2: visualización para revisar las geometríasEn la parte superior se indica el número de geometrías que quedan pendientes de revisar; e inmediatamente debajo de estas se muestra la información referida a la geometría que se está mostrando en la imagen.Viendo la geometría objetivo sobre el fondo es necesario tomar una decisión:Correcta (verde) → la geometría es acertada. Pasa automáticamente a la siguiente.Duda (amarillo) → la geometría genera dudas al usuario revisor a cerca de si es apropiada o no. Pasa automáticamente a la siguiente.Incorrecta (rojo) → la geometría es errónea. Pasa automáticamente a la siguiente.Saltar → está la opción de pasar a la siguiente geometría sin evaluar la presentePara ayudar al revisor, se dispone además del botón ‘Ver en Visor’. Este abre otra pestaña que redirige al Visor 2D. Muestra en rojo la geometría objetivo, y pone a disposición del usuario todas las utilidades del mismo: permite probar otros fondos, cargar otras capas para comparar...Figura 3: visualización de la geometría objetivo desde Visor 2DEn la parte inferior de la aplicación de “Test de Geometrías” se indica la tabla de base de datos en la que se guardan estas decisiones tomadas. También se da la opción de descargar un archivo .csv que contiene esta misma información.Cambiar de testSi se está revisando una capa, y posteriormente se quiere cambiar a otra, desde el desplegable de la parte superior se cambia la capa objetivo y se ‘Inicia test’.3. MANUAL PARA ADMINISTRADORESObjetivoEl objetivo de los administradores es configurar los test es decir, las capas (puntos, líneas o polígonos) de base de datos a revisar por los usuarios. La configuración se lleva a cabo mediante la edición de tablas albergadas en bases de datos.Configuración de los testLocalización de la tabla de configuraciónLa tabla en la cuál se configuran los diferentes test es test_geom_config. Esta esta almacenada en la base de datos BDIdearagon, en el esquema carto, tanto en los entornos de desarrollo (biv-02) como en producción (bov-03).Configuración del testEn esta tabla hay diversos campos a rellenar (opcionales solo los que lo indica):pk → número correlativo.tabla → capa objetivo sobre la que se quiere hacer la revisión. Indicar esquema.nombretabla. Si se está trabajando en desarrollo, este punto aunque no se especifique, tomará las capas de desarrollo. E igual para producción.conexion_bd → nombre del esquema que tendrá permisos para ver/editar la tabla que se generará y que almacenará las decisiones tomadas por los usuariosfiltro → opcional. Permite hacer un filtro con SQL (solo el WHERE) sobre los atributos de la tabla.campo_geom → indicar el nombre del campo que almacena la geometría. Habitualmente shape  o geom.patron_url_visor → rellenar con la URL del Visor 2D de la capa activa + QUERY. Se presenta un ejemplo a continuación, donde aparecen resaltados los segmentos a cambiar: https://idearagondes.aragon.es/visor/index.html?ACTIVELAYER=NOMBREDELACAPA&VISIBLELAYERS=NOMBREDELACAPA&QUERY=CAMPOUNÍVOCO=<<CAMPOUNÍVOCO>> . No es necesario que la capa este subida al visor.campo_pk → nombre del campo de la capa objetivo que es identificador único. La aplicación irá pasando por cada uno de los diferentes registros que haya.tabla_test → tabla sobre la que se va a almacenar la información de las decisiones tomadas por los usuarios. Indicar esquema.nombretabla.  Si se está trabajando en desarrollo, la tabla se almacenará en desarrollo aunque no se especifique. E igual para producción. Hay que recordar que a esta solo tendrá permisos de visualización y edición el esquema mencionado en el campo conexion_bd.campo_label → nombre del campo que contiene información sobre las geometrías a representar. Aparecerá en la parte superior de la aplicación de “Test de geometrías” junto con el campo_pk.Figura 4: tabla test_geom_config en DesarrolloUna vez se hayan guardado los cambios, si se han rellenado los campos correctamente, aparecerá el nuevo test disponible en la aplicación.Supervisión de las decisiones tomadasLocalización de la tabla de las decisionesLoa tabla que almacena las decisiones tomadas es visible y editable desde el esquema configurado en el campo conexion_bd en la tabla  test_geom_config. El nombre de la tabla y el esquema donde se almacena será igual al contenido del campo tabla_test de la tabla  test_geom_config. Otra opción es entrar desde la propia aplicación. Se entra al test de interés y en el apartado de “Descargar .csv” se descarga la tabla con la información de las decisiones tomadas. Es igual a la tabla de la base de datos.Estructura de la tablaLa tabla que se genera para almacenar las decisiones tiene las siguientes columnas, independientemente del test que se aplique:test_id → hace referencia al pk de la tabla test_geom_config del cuál es resultado esta tablapk → se relaciona directamente con el campo_pk de la tabla test_geom_config. Es el identificador único de la capa original. Permite relacionar la información de partida con las decisiones tomadas para cada una de las geometrías.correcta → será True, cuando en la aplicación se haya marcado como “Correcta” la geometría. Será False, para aquellas etiquetadas como “Incorrectas”. Finalmente, será [null], para las “Duda”.usuario → correo corporativo del Gobierno de Aragón del usuario que ha tomado la decisiónfecha → momento en el que se ha realizado la revisión de esa geometría.Esta tabla se va complementado automáticamente conforme se van tomando decisiones desde la aplicación. Permite de esta manera revisar aquellas geometrías que lo requieran, y aclarar aquellas que han quedado en “Duda”.Figura 5: ejemplo de tabla de decisiones test_v_aeros_funcionamiento