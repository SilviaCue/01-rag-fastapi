Manual
	
INSTALACIÓN SUPERSET
+ PLUGIN OPENLAYERS
ÍNDICE
INSTALACIÓN DE SUPERSET	3
Establecer superset como servicio	6
INSTALACIÓN PLUGIN OPENLAYERS	8
INSTALACIÓN DE SUPERSET
Para instalar Superset (SIN PyPi ni Docker) los requisitos del sistema son los siguientes:
Ubuntu 22 (se evita Python 3.12 por compatibilidad)
20GB de disco, 8GB RAM, 2 CPU virtuales
Instalación de dependencias:
sudo apt update
sudo apt install -y postgresql postgresql-contrib libpq-dev build-essential
sudo -u postgres createuser --pwprompt superset
sudo -u postgres createdb --owner=superset superset
sudo apt update
sudo apt install -y build-essential libssl-dev zlib1g-dev libncurses5-dev libncursesw5-dev libreadline-dev libsqlite3-dev libgdbm-dev libdb5.3-dev libbz2-dev libexpat1-dev liblzma-dev tk-dev libffi-dev git curl wget libpq-dev libmysqlclient-dev libcurl4-openssl-dev libjpeg-dev python3-pip python3-dev libldap2-dev libsasl2-dev libssl-dev vim nodejs npm python3-venv
(Si el sistema es Ubuntu 24 hace falta Python 3.10), tiene 3.12. En Ubuntu 22 no hace falta ya lo tiene.
Para instalar Python 3.10:
cd /usr/src
sudo wget https://www.python.org/ftp/python/3.10.14/Python-3.10.14.tgz
sudo tar xzf Python-3.10.14.tgz
cd Python-3.10.14
sudo ./configure --enable-optimizations
sudo make -j$(nproc)
sudo make altinstall
Una vez se tiene Python 3.10 seguir con la instalación:
git clone --branch 4.1.2 --depth 1 https://github.com/apache/superset.git 
python3 -m venv venv
source venv/bin/activate
pip install --upgrade pip setuptools wheel
cd superset/
 
pip install -r requirements/development.txt
pip install -e .
 
openssl rand -hex 64
Con el resultado anterior completar secret key del comando anterior y path a db:
vi superset_config.py
Coger el contenido de https://superset.apache.org/docs/configuration/configuring-superset/#secret_key-rotation
export SUPERSET_CONFIG_PATH=superset_config.py
export FLASK_APP=superset
superset db upgrade
superset fab create-admin --username admin --firstname Admin --lastname User --email admin@example.com --password Idearium2025!
superset load_examples
cd superset-frontend/
Ahora para compilar el front de superset:
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.7/install.sh | bash
source ~/.bashrc
nvm install 18
nvm use 18
 
npm install core-js@3.37.1 --debug
npx update-browserslist-db@latest
npm run build --debug
Iniciar Superset una vez que ha compilado todo correctamente:
superset init
superset run -p 8088 -h 0.0.0.0 --with-threads --reload --debugger
Para la ejecución posterior (Si no se establece Superset como servicio) hay que hacer cada vez que se quiera arrancar superset:
cd superset/
. ../venv/bin/activate
export SUPERSET_CONFIG_PATH=superset_config.py
export FLASK_APP=superset
superset init
superset run -p 8088 -h 0.0.0.0 --with-threads --reload --debugger
Establecer superset como servicio
Para establecer Superset como servicio y que arranque solo cada vez que se encienda la máquina y sea más sencillo pararlo, iniciarlo y reiniciarlo, se puede hacer lo siguiente:
Crear el fichero de unidad
sudo nano /etc/systemd/system/superset.service
Figura 1: Fichero de unidad
Una vez creado y guardado ese fichero habilitar el servicio:
sudo systemctl daemon-reload
sudo systemctl enable superset
Una vez habilitado arrancar el servicio:
sudo systemctl start superset
Para parar:
sudo systemctl stop superset
Para ver el estado (si está activo o inactivo):
sudo systemctl status superset
Figura 2: Estado servicio superset
INSTALACIÓN PLUGIN OPENLAYERS
Para instalar el plugin de visualización de mapas de OpenLayers, lo primero es clonar de este repositorio: https://github.com/frankrowe/superset-plugin-chart-openlayers
git clone https://github.com/frankrowe/superset-plugin-chart-openlayers.git
cd superset-plugin-chart-openlayers
Figura 3: Plugin clonado
Editar tsconfig.json
Para añadir:
"references": [
  {
    "path": "../../packages/superset-ui-chart-controls"
  },
  {
    "path": "../../packages/superset-ui-core"
  }
]
Y:
"../../types/**/*"
"extends": "../../tsconfig.json",
“If your Superset plugin exists in the superset-frontend directory and you wish to resolve TypeScript errors about @superset-ui/core not being resolved correctly, add the following to your tsconfig.json” Y
“You may also wish to add the following to the include array in tsconfig.json to make Superset types available to your plugin:”
Así queda:
Figura 4: tsconfig.json modificado
Para modificar el Plugin internamente estos son los ficheros que se deben tocar
Una vez hecho esto compilar el plugin con:
npm ci
npm run build
Ahora desde la carpeta de la instalación del frontend, enlazar al plugin:
cd ../superset/superset-frontend
npm install --save ../../superset-plugin-chart-openlayers
Para comprobar que está bien enlazado
npm ls superset-plugin-chart-openlayers
Figura 5: Plugin correctamente enlazado
Ahora se tiene que modificar el MainPresets.js para añadir el plugin, está aquí 
superset-frontend/src/visualizations/presets/MainPreset.js Añadir:
import { SupersetPluginChartOpenlayers } from 'superset-plugin-chart-openlayers';
new SupersetPluginChartOpenlayers().configure({ key: 'superset-plugin-chart-openlayers' }),
Por último, limpiar y volver a compilar el front de superset en /superset/superset-frontend:
rm -rf node_modules/.cache
npm run build --debug
Y ya estaría instalado, para usarlo hay que seleccionar el chart tipo OpenLayers:
Figura 6: Vista del plugin en superset
Un ejemplo de mapa representado en Superset con este plugin el de municipios de Aragón:
Figura 7: Municipios Aragón

Paso 1: Sin título
idearium


Paso 1: Listar el plugin
almudena_superset@superset-vm-last:~/superset/superset-frontend$
superset@4.1.2 /home/almudena_superset/superset/superset-frontend
npm ls superset-plugin-chart-openlayers
superset-plugin-chart-openlayers@0.1.2 -> ./../../superset-plugin-chart-openlayers
almudena_superset@superset-vm-last:~/superset/superset-frontend$
Se ejecuta el comando `npm ls superset-plugin-chart-openlayers` para listar el plugin `superset-plugin-chart-openlayers` y sus dependencias.

Paso 1: Iniciar Superset
sudo systemctl start superset
Comando para iniciar el servicio de Superset.

Paso 2: Verificar el estado de Superset
sudo systemctl status superset
Comando para verificar el estado del servicio de Superset. Muestra información sobre si está activo, la memoria utilizada, etc.

Paso 1: Listar archivos
> almudena_superset@superset X +
almudena_superset@superset-vm-last:~/superset-plugin-chart-openlayers/src/plugin$ ls
buildQuery.ts controlPanel.ts index.ts transformProps.ts
almudena_superset@superset-vm-last:~/superset-plugin-chart-openlayers/src/plugin$
Listar los archivos en el directorio `superset-plugin-chart-openlayers/src/plugin` usando el comando `ls`.

Paso 1: Configuración de TypeScript
{
"rootDir": "src",
"skipLibCheck": true,
"emitDeclarationOnly": true,
"resolveJsonModule": true,
"types": ["jest"],
"typeRoots": ["./node_modules/@types"]
},
Configura las opciones rootDir, skipLibCheck, emitDeclarationOnly, resolveJsonModule, types, y typeRoots.

Paso 2: Exclusiones
"exclude": ["lib", "test"],
Excluye las carpetas lib y test.

Paso 3: Inclusiones
"include": [
"src/**/*",
"types/**/*",
"../superset/superset-frontend/types/**/*"
]
Incluye las carpetas src, types y ../superset/superset-frontend/types.

Paso 1: Seleccionar datos
Instancias de VM - Compute En...pureba ol...carto.t101_municipios_geoj...
Selecciona la fuente de datos 'carto.t101_municipios_geoj...'

Paso 2: Seleccionar métricas y columnas
COUNT(*)...abc geojson...abc d_muni_ine
En la sección 'Query', selecciona la métrica 'COUNT(*)' y las columnas 'abc geojson' y 'abc d_muni_ine'

Paso 3: Definir límite de filas
ROW LIMIT
10000
Establece el límite de filas a 10000

Paso 4: Configurar el mapa
HEADER TEXT
Openlayers Map
TILE LAYER URL
https://tile.openstreetmap.org/{z}/{x}/{y}
ZOOM
5
LATITUDE
40
LONGITUDE
-3.7
POLYGON FILL COLOR
En 'Map Controls', configura el mapa con los siguientes parámetros:
- HEADER TEXT: Openlayers Map
- TILE LAYER URL: https://tile.openstreetmap.org/{z}/{x}/{y}
- ZOOM: 5
- LATITUDE: 40
- LONGITUDE: -3.7
- POLYGON FILL COLOR: (color seleccionado)

Paso 1: Crear archivo superset.service
GNU nano 6.2
/etc/systemd/system/superset.service
[Unit]
Description=Apache Superset
After=network.target postgresql.service
[Service]
Type=simple
# Usuario y grupo bajo los cuales va Superset
User=almudena_superset
Group=almudena_superset
Environment="SUPERSET_CONFIG_PATH=/home/almudena_superset/superset/superset_config.py"
Environment="FLASK_APP=superset"
# Directorio de trabajo donde se ejecuta el comando
WorkingDirectory=/home/almudena_superset/superset
# arrancar Superset desde el entorno virtual
ExecStart=/home/almudena_superset/venv/bin/superset run -p 8088 -h 0.0.0.0 --with-threads
# Reiniciar siempre que el proceso falle
Restart=always
[Install]
WantedBy=multi-user.target
Crear el archivo /etc/systemd/system/superset.service con nano y pegar el contenido

Paso 1: Abrir tsconfig.json
GNU nano 6.2
{  "extends": "../superset/superset-frontend/tsconfig.json",
  "references": [
    {      "path": "../superset/superset-frontend/packages/superset-ui-chart-controls"
    },
    {      "path": "../superset/superset-frontend/packages/superset-ui-core"
    }
  ],
  "compilerOptions": {    "allowJs": true,    "allowSyntheticDefaultImports": true,    "declaration": true,    "declarationDir": "lib",    "esModuleInterop": true,    "forceConsistentCasingInFileNames": true,    "isolatedModules": false,    "jsx": "react",    "lib": ["dom", "esnext"],    "module": "esnext"    "moduleResolution": "node",    "noEmitOnError": true,    "noImplicitReturns": true,    "noUnusedLocals": true,    "outDir": "lib",    "pretty": true,    "removeComments": false,    "strict": true,    "target": "es2015",    "useDefineForClassFields": false,    "composite": true,    "declarationMap": true,    "rootDir": "src",    "skipLibCheck": true,
El archivo tsconfig.json se abre con el editor nano.

Paso 1: Elegir un conjunto de datos
Choose a dataset
Add a dataset or view instructions

Paso 2: Elegir el tipo de gráfico
All charts
Featured
Category
Correlation
Distribution
Evolution
Openlayers


Paso 1: Listar archivos
almudena_superset@superset-vm-last:~$ ls
mysql-apt-config_0.8.29-1_all.deb superset-plugin-chart-leaflet-gobar venv
superset superset-plugin-chart-openlayers
almudena_superset@superset-vm-last:~$
Se lista el contenido del directorio actual con el comando ls.